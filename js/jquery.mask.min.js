!function(factory,jQuery,Zepto){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports&&"undefined"==typeof Meteor?module.exports=factory(require("jquery")):factory(jQuery||Zepto)}((function($){"use strict";var Mask=function(el,mask,options){var p={invalid:[],getCaret:function(){try{var sel,pos=0,ctrl=el.get(0),dSel=document.selection,cSelStart=ctrl.selectionStart;return dSel&&-1===navigator.appVersion.indexOf("MSIE 10")?((sel=dSel.createRange()).moveStart("character",-p.val().length),pos=sel.text.length):(cSelStart||"0"===cSelStart)&&(pos=cSelStart),pos}catch(e){}},setCaret:function(pos){try{if(el.is(":focus")){var range,ctrl=el.get(0);ctrl.setSelectionRange?ctrl.setSelectionRange(pos,pos):((range=ctrl.createTextRange()).collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select())}}catch(e){}},events:function(){el.on("keydown.mask",(function(e){el.data("mask-keycode",e.keyCode||e.which),el.data("mask-previus-value",el.val()),el.data("mask-previus-caret-pos",p.getCaret()),p.maskDigitPosMapOld=p.maskDigitPosMap})).on($.jMaskGlobals.useInput?"input.mask":"keyup.mask",p.behaviour).on("paste.mask drop.mask",(function(){setTimeout((function(){el.keydown().keyup()}),100)})).on("change.mask",(function(){el.data("changed",!0)})).on("blur.mask",(function(){oldValue===p.val()||el.data("changed")||el.trigger("change"),el.data("changed",!1)})).on("blur.mask",(function(){oldValue=p.val()})).on("focus.mask",(function(e){!0===options.selectOnFocus&&$(e.target).select()})).on("focusout.mask",(function(){options.clearIfNotMatch&&!regexMask.test(p.val())&&p.val("")}))},getRegexMask:function(){for(var maskChunks=[],translation,pattern,optional,recursive,oRecursive,r,i=0;i<mask.length;i++)(translation=jMask.translation[mask.charAt(i)])?(pattern=translation.pattern.toString().replace(/.{1}$|^.{1}/g,""),optional=translation.optional,(recursive=translation.recursive)?(maskChunks.push(mask.charAt(i)),oRecursive={digit:mask.charAt(i),pattern:pattern}):maskChunks.push(optional||recursive?pattern+"?":pattern)):maskChunks.push(mask.charAt(i).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));return r=maskChunks.join(""),oRecursive&&(r=r.replace(new RegExp("("+oRecursive.digit+"(.*"+oRecursive.digit+")?)"),"($1)?").replace(new RegExp(oRecursive.digit,"g"),oRecursive.pattern)),new RegExp(r)},destroyEvents:function(){el.off(["input","keydown","keyup","paste","drop","blur","focusout",""].join(".mask "))},val:function(v){var isInput=el.is("input"),method=isInput?"val":"text",r;return arguments.length>0?(el[method]()!==v&&el[method](v),r=el):r=el[method](),r},calculateCaretPosition:function(oldVal){var newVal=p.getMasked(),caretPosNew=p.getCaret();if(oldVal!==newVal){var caretPosOld=el.data("mask-previus-caret-pos")||0,newValL=newVal.length,oldValL=oldVal.length,maskDigitsBeforeCaret=0,maskDigitsAfterCaret=0,maskDigitsBeforeCaretAll=0,maskDigitsBeforeCaretAllOld=0,i=0;for(i=caretPosNew;i<newValL&&p.maskDigitPosMap[i];i++)maskDigitsAfterCaret++;for(i=caretPosNew-1;i>=0&&p.maskDigitPosMap[i];i--)maskDigitsBeforeCaret++;for(i=caretPosNew-1;i>=0;i--)p.maskDigitPosMap[i]&&maskDigitsBeforeCaretAll++;for(i=caretPosOld-1;i>=0;i--)p.maskDigitPosMapOld[i]&&maskDigitsBeforeCaretAllOld++;if(caretPosNew>oldValL)caretPosNew=10*newValL;else if(caretPosOld>=caretPosNew&&caretPosOld!==oldValL){if(!p.maskDigitPosMapOld[caretPosNew]){var caretPos=caretPosNew;caretPosNew-=maskDigitsBeforeCaretAllOld-maskDigitsBeforeCaretAll,caretPosNew-=maskDigitsBeforeCaret,p.maskDigitPosMap[caretPosNew]&&(caretPosNew=caretPos)}}else caretPosNew>caretPosOld&&(caretPosNew+=maskDigitsBeforeCaretAll-maskDigitsBeforeCaretAllOld,caretPosNew+=maskDigitsAfterCaret)}return caretPosNew},behaviour:function(e){e=e||window.event,p.invalid=[];var keyCode=el.data("mask-keycode");if(-1===$.inArray(keyCode,jMask.byPassKeys)){var newVal=p.getMasked(),caretPos=p.getCaret(),oldVal=el.data("mask-previus-value")||"";return setTimeout((function(){p.setCaret(p.calculateCaretPosition(oldVal))}),$.jMaskGlobals.keyStrokeCompensation),p.val(newVal),p.setCaret(caretPos),p.callbacks(e)}},getMasked:function(skipMaskChars,val){var buf=[],value=void 0===val?p.val():val+"",m=0,maskLen=mask.length,v=0,valLen=value.length,offset=1,addMethod="push",resetPos=-1,maskDigitCount=0,maskDigitPosArr=[],lastMaskChar,check,lastUntranslatedMaskChar;for(options.reverse?(addMethod="unshift",offset=-1,lastMaskChar=0,m=maskLen-1,v=valLen-1,check=function(){return m>-1&&v>-1}):(lastMaskChar=maskLen-1,check=function(){return m<maskLen&&v<valLen});check();){var maskDigit=mask.charAt(m),valDigit=value.charAt(v),translation=jMask.translation[maskDigit];translation?(valDigit.match(translation.pattern)?(buf[addMethod](valDigit),translation.recursive&&(-1===resetPos?resetPos=m:m===lastMaskChar&&m!==resetPos&&(m=resetPos-offset),lastMaskChar===resetPos&&(m-=offset)),m+=offset):valDigit===lastUntranslatedMaskChar?(maskDigitCount--,lastUntranslatedMaskChar=void 0):translation.optional?(m+=offset,v-=offset):translation.fallback?(buf[addMethod](translation.fallback),m+=offset,v-=offset):p.invalid.push({p:v,v:valDigit,e:translation.pattern}),v+=offset):(skipMaskChars||buf[addMethod](maskDigit),valDigit===maskDigit?(maskDigitPosArr.push(v),v+=offset):(lastUntranslatedMaskChar=maskDigit,maskDigitPosArr.push(v+maskDigitCount),maskDigitCount++),m+=offset)}var lastMaskCharDigit=mask.charAt(lastMaskChar);maskLen!==valLen+1||jMask.translation[lastMaskCharDigit]||buf.push(lastMaskCharDigit);var newVal=buf.join("");return p.mapMaskdigitPositions(newVal,maskDigitPosArr,valLen),newVal},mapMaskdigitPositions:function(newVal,maskDigitPosArr,valLen){var maskDiff=options.reverse?newVal.length-valLen:0;p.maskDigitPosMap={};for(var i=0;i<maskDigitPosArr.length;i++)p.maskDigitPosMap[maskDigitPosArr[i]+maskDiff]=1},callbacks:function(e){var val=p.val(),changed=val!==oldValue,defaultArgs=[val,e,el,options],callback=function(name,criteria,args){"function"==typeof options[name]&&criteria&&options[name].apply(this,args)};callback("onChange",!0===changed,defaultArgs),callback("onKeyPress",!0===changed,defaultArgs),callback("onComplete",val.length===mask.length,defaultArgs),callback("onInvalid",p.invalid.length>0,[val,e,el,p.invalid,options])}};el=$(el);var jMask=this,oldValue=p.val(),regexMask;mask="function"==typeof mask?mask(p.val(),void 0,el,options):mask,jMask.mask=mask,jMask.options=options,jMask.remove=function(){var caret=p.getCaret();return jMask.options.placeholder&&el.removeAttr("placeholder"),el.data("mask-maxlength")&&el.removeAttr("maxlength"),p.destroyEvents(),p.val(jMask.getCleanVal()),p.setCaret(caret),el},jMask.getCleanVal=function(){return p.getMasked(!0)},jMask.getMaskedVal=function(val){return p.getMasked(!1,val)},jMask.init=function(onlyMask){if(onlyMask=onlyMask||!1,options=options||{},jMask.clearIfNotMatch=$.jMaskGlobals.clearIfNotMatch,jMask.byPassKeys=$.jMaskGlobals.byPassKeys,jMask.translation=$.extend({},$.jMaskGlobals.translation,options.translation),jMask=$.extend(!0,{},jMask,options),regexMask=p.getRegexMask(),onlyMask)p.events(),p.val(p.getMasked());else{options.placeholder&&el.attr("placeholder",options.placeholder),el.data("mask")&&el.attr("autocomplete","off");for(var i=0,maxlength=!0;i<mask.length;i++){var translation=jMask.translation[mask.charAt(i)];if(translation&&translation.recursive){maxlength=!1;break}}maxlength&&el.attr("maxlength",mask.length).data("mask-maxlength",!0),p.destroyEvents(),p.events();var caret=p.getCaret();p.val(p.getMasked()),p.setCaret(caret)}},jMask.init(!el.is("input"))};$.maskWatchers={};var HTMLAttributes=function(){var input=$(this),options={},prefix="data-mask-",mask=input.attr("data-mask");if(input.attr(prefix+"reverse")&&(options.reverse=!0),input.attr(prefix+"clearifnotmatch")&&(options.clearIfNotMatch=!0),"true"===input.attr(prefix+"selectonfocus")&&(options.selectOnFocus=!0),notSameMaskObject(input,mask,options))return input.data("mask",new Mask(this,mask,options))},notSameMaskObject=function(field,mask,options){options=options||{};var maskObject=$(field).data("mask"),stringify=JSON.stringify,value=$(field).val()||$(field).text();try{return"function"==typeof mask&&(mask=mask(value)),"object"!=typeof maskObject||stringify(maskObject.options)!==stringify(options)||maskObject.mask!==mask}catch(e){}},eventSupported=function(eventName){var el=document.createElement("div"),isSupported;return(isSupported=(eventName="on"+eventName)in el)||(el.setAttribute(eventName,"return;"),isSupported="function"==typeof el[eventName]),el=null,isSupported};$.fn.mask=function(mask,options){options=options||{};var selector=this.selector,globals=$.jMaskGlobals,interval=globals.watchInterval,watchInputs=options.watchInputs||globals.watchInputs,maskFunction=function(){if(notSameMaskObject(this,mask,options))return $(this).data("mask",new Mask(this,mask,options))};return $(this).each(maskFunction),selector&&""!==selector&&watchInputs&&(clearInterval($.maskWatchers[selector]),$.maskWatchers[selector]=setInterval((function(){$(document).find(selector).each(maskFunction)}),interval)),this},$.fn.masked=function(val){return this.data("mask").getMaskedVal(val)},$.fn.unmask=function(){return clearInterval($.maskWatchers[this.selector]),delete $.maskWatchers[this.selector],this.each((function(){var dataMask=$(this).data("mask");dataMask&&dataMask.remove().removeData("mask")}))},$.fn.cleanVal=function(){return this.data("mask").getCleanVal()},$.applyDataMask=function(selector){var $selector;((selector=selector||$.jMaskGlobals.maskElements)instanceof $?selector:$(selector)).filter($.jMaskGlobals.dataMaskAttr).each(HTMLAttributes)};var globals={maskElements:"input,td,span,div",dataMaskAttr:"*[data-mask]",dataMask:!0,watchInterval:300,watchInputs:!0,keyStrokeCompensation:10,useInput:!/Chrome\/[2-4][0-9]|SamsungBrowser/.test(window.navigator.userAgent)&&eventSupported("input"),watchDataMask:!1,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}}};$.jMaskGlobals=$.jMaskGlobals||{},(globals=$.jMaskGlobals=$.extend(!0,{},globals,$.jMaskGlobals)).dataMask&&$.applyDataMask(),setInterval((function(){$.jMaskGlobals.watchDataMask&&$.applyDataMask()}),globals.watchInterval)}),window.jQuery,window.Zepto);